# Задача: Реализация системы пользовательских профилей

## I. Общая цель

Расширить существующий бэкенд-сервис, добавив функционал пользовательских профилей. Система должна позволять пользователям создавать и управлять своими публичными профилями, которые будут связаны с их учётными записями.

---

## II. Модель данных / Схема базы данных

Необходимо создать две новые сущности: **`Profile`** и **`Tag`**.

### 1. Сущность "Профиль" (`Profile`)

Эта сущность хранит всю публичную информацию о пользователе. Она должна быть напрямую связана с основной моделью пользователя (User) отношением "один к одному".

-   `id`: Уникальный идентификатор профиля (может быть UUID или числовой).
-   `userId`: Внешний ключ, связывающий профиль с учётной записью пользователя. **Эта связь обязательна.**
-   `handle`: (string) Уникальный, короткий идентификатор пользователя, используемый в URL (например, `@username`). Должен быть в нижнем регистре, без пробелов.
-   `displayName`: (string) Отображаемое имя пользователя (никнейм).
-   `bio`: (string, nullable) Короткая биография или описание "о себе". Может быть пустым.
-   `avatarUrl`: (string, nullable) URL-адрес изображения аватара. Может быть пустым.
-   `createdAt`: Временная метка создания.
-   `updatedAt`: Временная метка последнего обновления.

### 2. Сущность "Тег" (`Tag`)

Теги — это небольшие информационные плашки в профиле. Профиль может иметь несколько тегов (отношение "многие ко многим").

-   `id`: Уникальный идентификатор тега.
-   `profileId`: Внешний ключ, связывающий тег с профилем.
-   `text`: (string) Основной текст тега (например, "Python Developer").
-   `iconName`: (string, nullable) Название иконки из какой-либо библиотеки (например, "python", "code-slash").
-   `color`: (string, nullable) Цвет тега в HEX-формате (например, `#4B8BBE`).

---

## III. Интеграция с аутентификацией

1.  **При регистрации**: После успешного создания новой учётной записи пользователя (`POST /auth/register`), система должна **автоматически** создавать для него пустой `Profile`.
    -   `handle` может быть сгенерирован автоматически из email или оставлен пустым до первого обновления.
    -   `displayName` может быть взят из части email до символа `@`.

2.  **Защита эндпоинтов**: Все эндпоинты для **изменения** профиля (`POST`, `PUT`, `DELETE`) должны быть защищены. Они должны требовать валидный `access_token` и работать только с профилем того пользователя, который авторизован в данный момент.

---

## IV. Новые API эндпоинты для профилей

### 1. Получить публичный профиль пользователя

-   **Endpoint**: `GET /profiles/{handle}`
-   **Описание**: Возвращает публичную информацию о профиле пользователя по его `@handle`. Этот эндпоинт должен быть публичным и не требовать аутентификации.
-   **Параметры URL**:
    -   `handle`: Уникальный хендл пользователя.
-   **Успешный ответ (200 OK)**:
    ```json
    {
      "handle": "example_user",
      "displayName": "Example User",
      "bio": "Software developer creating amazing things.",
      "avatarUrl": "[https://example.com/avatar.png](https://example.com/avatar.png)",
      "tags": [
        {
          "id": 1,
          "text": "Python Developer",
          "iconName": "python",
          "color": "#4B8BBE"
        },
        {
          "id": 2,
          "text": "FastAPI",
          "iconName": "bolt",
          "color": "#009688"
        }
      ]
    }
    ```
-   **Ответ при ошибке (404 Not Found)**: Если профиль с таким `handle` не найден.

### 2. Получить/обновить свой профиль

-   **Endpoint**: `PUT /profile/me` (также можно `GET /profile/me` для получения)
-   **Защита**: Требует аутентификации.
-   **Описание**: Позволяет авторизованному пользователю получить или обновить данные **своего** профиля.
-   **Тело запроса (для `PUT`)**:
    ```json
    {
      "handle": "new_handle",
      "displayName": "My New Name",
      "bio": "Updated biography.",
      "avatarUrl": "[https://example.com/new_avatar.png](https://example.com/new_avatar.png)"
    }
    ```
-   **Успешный ответ (200 OK)**: Возвращает обновлённый объект профиля.
-   **Ответ при ошибке (400 Bad Request)**: Если `handle` уже занят или не соответствует требованиям (неверные символы).

### 3. Управление тегами профиля

#### Добавить тег в свой профиль

-   **Endpoint**: `POST /profile/me/tags`
-   **Защита**: Требует аутентификации.
-   **Описание**: Добавляет новый тег к профилю текущего пользователя.
-   **Тело запроса**:
    ```json
    {
      "text": "Data Science",
      "iconName": "brain",
      "color": "#F44336"
    }
    ```
-   **Успешный ответ (201 Created)**: Возвращает созданный объект тега.

#### Удалить тег из своего профиля

-   **Endpoint**: `DELETE /profile/me/tags/{tagId}`
-   **Защита**: Требует аутентификации.
-   **Описание**: Удаляет тег из профиля текущего пользователя.
-   **Параметры URL**:
    -   `tagId`: ID тега, который нужно удалить.
-   **Успешный ответ (204 No Content)**.
-   **Ответ при ошибке (403 Forbidden)**: Если пользователь пытается удалить тег, который ему не принадлежит.

---

## V. Ключевые требования к реализации

-   **Уникальность `handle`**: Система должна гарантировать, что `handle` каждого пользователя уникален во всей системе.
-   **Валидация**: Все входящие данные от пользователя (длина `bio`, формат `handle`, HEX-код `color`) должны проходить валидацию.
-   **Авторизация**: Должна быть чёткая проверка, что пользователь может изменять только свой собственный профиль и свои собственные теги.

{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJmMTY5Njk3MC05YjI4LTRmM2ItYjUzYS1hZTY3NzgzOTczNjAiLCJleHAiOjE3NTgzMTE2MTUsInR5cGUiOiJhY2Nlc3MifQ.AHile5jauDpFCODlE27llILsFSUXGArtKvPVBi02b6E",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJmMTY5Njk3MC05YjI4LTRmM2ItYjUzYS1hZTY3NzgzOTczNjAiLCJleHAiOjE3NTg5MTU1MTUsInR5cGUiOiJyZWZyZXNoIn0.NHNRFukaSSz7teIV8xkdk4c0N3CDFtC17I_FQsa0PvY",
  "token_type": "bearer"
}